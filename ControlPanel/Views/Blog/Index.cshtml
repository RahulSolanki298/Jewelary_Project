@using Common;
@{
    <link href="~/jqxcontent/jqwidgets/styles/jqx.base.css" rel="stylesheet" />
    <link href="~/jqxcontent/jqwidgets/styles/jqx.fluent.css" rel="stylesheet" />

    <style>
        span[id^="jqxWidget"] {
            color: transparent !important;
        }
    </style>
}
<div class="container-fluid">
    <div class="row mb-0">
        <div class="col-xxl-10 col-xl-10 col-lg-9 col-md-9 col-sm-8">
            <h4 class=""><b>Blog Post List</b></h4>
        </div>
    </div>


    <div class="card mt-2">
        <div class="card-body">
            <div class="row mt-2">
                <div class="col-xxl-12 col-xl-12 col-lg-12 col-md-12 col-sm-12">
                    <div id="divDetails">

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@section Scripts
{
    @* JQX Widgets *@
    <script src="~/jqxcontent/jqwidgets/jqxcore.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxdata.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxcore.elements.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxdata.export.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxbuttons.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxscrollbar.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxmenu.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxcheckbox.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxlistbox.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxdropdownlist.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.sort.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.pager.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.selection.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.edit.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.filter.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.columnsresize.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.aggregates.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxpanel.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.columnsreorder.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxtextarea.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxinput.js"></script>
    <script src="~/jqxcontent/jqwidgets/jqxgrid.grouping.js"></script>

    @* JQX Widgets *@
<script>
        var resultData = [];
        var source;
        $(document).ready(function () {

            loadData();

             $('#divDetails').on('filter', function (event) {
                var filteredData = $('#divDetails').jqxGrid('getrows');
                updateFilterItems(filteredData);
            });


            $("#divDetails").on("cellclick", function (event) {

                // event arguments.
                var args = event.args;
                // row's bound index.
                var rowBoundIndex = args.rowindex;
                // row's visible index.
                var rowVisibleIndex = args.visibleindex;

                var dataField = args.datafield;
                var clsname = args.column.classname;

                var targetclass = args.originalEvent.target.classList[1];

                if (dataField == 'action') {
                    let data = $("#divDetails").jqxGrid('getrowdata', rowBoundIndex);
                    window.location.href = `@Url.Action("GetBlogById", "Blog")?id=${data.Id}`;
                }

            });


        });

        function loadData() {
            resultData = [];
            $('#divDetails').jqxGrid('clear');

            $.ajax({
                type: "get",
                url: "@Url.Action("getBlogList", "Blog")",
                dataType: "json",
                success: function (d) {
                    if (d.data.result.length > 0) {
                        resultData = JSON.parse(d.data.result);
                        source =
                        {
                            localdata: resultData,
                            datatype: "array"
                        };
                        var dataAdapter = new $.jqx.dataAdapter(source, {
                            loadComplete: function (data) { },
                            loadError: function (xhr, status, error) { }
                        });
                        var blackstyle = {
                            headerBackgroundColor: '#151542',
                            headerColor: '#fff',
                        };

                        var action = function (row, columnfield, value, defaulthtml, columnproperties, rowdata) {
                            return '<button title="" class="btn btn-dark btn-sm" style="margin:1px 15px;"><i class="bi bi-layout-text-window-reverse"></i></button>';
                        };
                        const imgBaseUrl = '@SD.ImgUrl';
                        $("#divDetails").jqxGrid(
                        {
                            width: "100%",
                            source: dataAdapter,
                            height: '700px',
                            selectionmode: 'singlerow',
                            columnsresize: true,
                            columnsreorder: true,
                            sortable: true,
                            altrows: true,
                            enabletooltips: true,
                            enablebrowserselection: true,
                            filterable: true,
                            editable: false,
                            showstatusbar: true,
                            rowsheight: 40,
                            columns: [
                                {
                                    text: '#', sortable: false, filterable: false, editable: false,
                                    groupable: false, draggable: false, resizable: false,
                                    datafield: '', columntype: 'number', pinned: true, style: blackstyle,
                                    align: 'center', cellsalign: 'center', width: 40,
                                    cellsrenderer: function (row, column, value) {
                                        return "<div style='margin:4px;'>" + (value + 1) + "</div>";
                                    }
                                },
                                {
                                        text: 'Action',
                                        datafield: 'action',
                                        sortable: false, filterable: false, editable: false,
                                        groupable: false, draggable: false, resizable: false,
                                        columntype: 'number',pinned: true,
                                        style: blackstyle,
                                        align: 'center', cellsalign: 'center',
                                        cellsrenderer: action,
                                        width: 60
                                },
                                {
                                    text: 'Image',
                                    datafield: 'BlogImage',
                                    style: blackstyle,
                                    width: 200,
                                    align: 'center',
                                    cellsalign: 'center',
                                    filterable: false,
                                    sortable: false,
                                    cellsrenderer: function (row, column, value) {
                                        if (value) {
                                            return `<div style="text-align:center; padding:4px;">
                                                           <img src="${imgBaseUrl}${value}" alt="Blog Image" style="width:60px; height:40px;" />
                                                    </div>`;
                                        } else {
                                            return `<div style="text-align:center; padding:4px;">No Image</div>`;
                                        }
                                    }
                                },
                                { text: 'Title', pinned: true, datafield: 'Title', style: blackstyle, width: 100, align: 'center', cellsalign: 'left', filtertype: 'checkedlist' },
                                { text: 'Description', pinned: true, datafield: 'Description', style: blackstyle, width: 100, align: 'center', cellsalign: 'left', filtertype: 'checkedlist' },
                                { text: 'Id', datafield: 'Id', hidden: true, style: blackstyle, width: 100, align: 'center', cellsalign: 'left', filtertype: 'checkedlist' },

                            ],
                        });
                    }
                }
            });
        }

        function updateFilterItems(filteredData) {
            var columns = $('#divDetails').jqxGrid('columns').records;

            columns.forEach(column => {
                var columnName = column.datafield;

                var uniqueValues = [...new Set(filteredData.map(row => row[columnName] === null ? "" : row[columnName]))].filter(value => value !== undefined);

                var updatedFilterItems = uniqueValues.map(value => value.toString());

                if (updatedFilterItems.length > 0) {
                    $('#divDetails').jqxGrid('setcolumnproperty', columnName, 'filteritems', updatedFilterItems);
                }
                else
                {
                    $('#divDetails').jqxGrid('setcolumnproperty', columnName, 'filteritems', []);
                }
            });
        }

</script>
}